# If you're running your own XTP (or using your own app on staging) this schema
# belongs to an extension point named "chat". 
#
# We should keep the XTP app that the deployed service uses in sync with this
# schema.
version: v1-draft
exports:
  handle:
    input:
      "$ref": "#/components/schemas/IncomingEvent"
      contentType: application/json

imports:
  react:
    input:
      "$ref": "#/components/schemas/OutgoingReaction"
      contentType: application/json
    output:
      "$ref": "#/components/schemas/Result"
      contentType: application/json

  request:
    input:
      "$ref": "#/components/schemas/OutgoingRequest"
      contentType: application/json
    output:
      "$ref": "#/components/schemas/Result"
      contentType: application/json

  sendMessage:
    input:
      "$ref": "#/components/schemas/OutgoingMessage"
      contentType: application/json
    output:
      "$ref": "#/components/schemas/Result"
      contentType: application/json

  watchMessage:
    input:
      type: string
      description: The ID of a message to watch
      contentType: text/plain; charset=utf-8
    output:
      "$ref": "#/components/schemas/Result"
      contentType: application/json

components:
  schemas:
    IncomingEvent:
      description: An incoming event
      properties:
        kind:
          type: string
          description: The reason for the event
        message:
          "$ref": '#/components/schemas/IncomingMessage'
          nullable: true
        reaction:
          "$ref": '#/components/schemas/IncomingReaction'
          nullable: true
        response:
          "$ref": '#/components/schemas/IncomingResponse'
          nullable: true
        channel:
          type: string
          description: The channel the message was received in

    OutgoingRequest:
      description: An HTTP request
      properties:
        method:
          type: string
          description: The HTTP method
          nullable: true
        url:
          type: string
          description: The URL
        headers:
          type: object
          description: The HTTP headers
          nullable: true
        body:
          type: string
          description: The HTTP body
          nullable: true

    OutgoingReaction:
      description: Send a reaction
      properties:
        messageId:
          type: string
          description: The message ID
        with:
          type: string
          description: The emoji reaction

    IncomingResponse:
      description: We received a response
      properties:
        id:
          type: string
          description: The identifier the plugin sent
        status:
          type: number
          description: The HTTP status code
        headers:
          type: object
          description: The HTTP headers
        body:
          type: string
          description: The HTTP body

    IncomingReaction:
      description: A reaction happened
      properties:
        message:
          "$ref": '#/components/schemas/IncomingMessage'
        from:
          type: string
          description: The username that reacted
        with:
          type: string
          description: The emoji reaction

    IncomingMessage:
      description: An incoming message
      properties:
        id:
          type: string
          description: An ID identifying the message
        content:
          type: string
          description: The message text
        author:
          type: object
          description: The author of the message
        reference:
          type: string
          description: The ID of the message to which this message replies
          nullable: true

    OutgoingMessage:
      description: An outgoing message
      properties:
        message:
          type: string
          description: The message text
        channel:
          type: string
          description: The channel the message was received in
          nullable: true
        reply:
          type: string
          description: A message ID to reply to
          nullable: true

    Result:
      description: A result
      properties:
        id:
          type: string
          description: An ID for the result
        errorCode:
          type: number
          description: |
            An error code. Zero indicates success. Negative numbers indicate failure.
